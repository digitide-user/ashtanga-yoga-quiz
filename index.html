<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>アシュタンガ ヨガ アーサナクイズ</title>
  <link rel="stylesheet" href="css/style.css?v=20250830-10" />
  <!-- alias to satisfy legacy path /css/styles.css and avoid MIME warnings -->
  <link rel="stylesheet" href="css/styles.css?v=20250830-10" />

  <!-- ★ Inline config: FORCE ON -->
  <script>
    window.ENABLE_ONLINE_RANKING = true;
    window.STRICT_ONLINE_RANKING = true;
    window.SUPABASE_URL = "https://utpcwlxxmgzkcrwfbiav.supabase.co";
    window.SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV0cGN3bHh4bWd6a2Nyd2ZiaWF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0MTYzNTgsImV4cCI6MjA3MTk5MjM1OH0.lCGFzl0pExl3uqsSh4h0jrPsmtowQ9618q4lZyxX4o4";
    console.log('[RANK CFG] inlined', {
      strict: window.STRICT_ONLINE_RANKING,
      enable: window.ENABLE_ONLINE_RANKING,
      url: (window.SUPABASE_URL||'').slice(0,32)+'…',
      keyLen: (window.SUPABASE_ANON_KEY||'').length
    });
  </script>

  <!-- EARLY compat (non-defer): prevent null from DOM queries -->
  <script>
    (function () {
      if (window.__EARLY_COMPAT__) return; window.__EARLY_COMPAT__ = true;
      const inject = (target, sel, place) => {
        const stub = document.createElement('div');
        if (typeof sel === 'string' && sel.startsWith('#')) stub.id = sel.slice(1);
        else if (typeof sel === 'string') stub.setAttribute('data-compat-selector', sel);
        (place && place.isConnected ? place : (document.body || document.documentElement)).appendChild(stub);
        console.warn('[compat-early] injected stub for', sel || target);
        return stub;
      };
      // getElementById
      const origGet = Document.prototype.getElementById;
      Document.prototype.getElementById = function (id) {
        const el = origGet.call(this, id);
        return el || inject('#' + id, '#' + id);
      };
      // Document.querySelector / All
      const oDQS  = Document.prototype.querySelector;
      const oDQSA = Document.prototype.querySelectorAll;
      Document.prototype.querySelector = function (sel) {
        const el = oDQS.call(this, sel);
        return el || inject('document.querySelector', sel);
      };
      Document.prototype.querySelectorAll = function (sel) {
        const list = oDQSA.call(this, sel);
        if (list && list.length) return list;
        const arr = []; arr.forEach = Array.prototype.forEach;
        console.warn('[compat-early] empty NodeList for', sel);
        return arr;
      };
      // Element.querySelector / All
      const oEQS  = Element.prototype.querySelector;
      const oEQSA = Element.prototype.querySelectorAll;
      Element.prototype.querySelector = function (sel) {
        const el = oEQS.call(this, sel);
        return el || inject('element.querySelector', sel, this);
      };
      Element.prototype.querySelectorAll = function (sel) {
        const list = oEQSA.call(this, sel);
        if (list && list.length) return list;
        const arr = []; arr.forEach = Array.prototype.forEach;
        console.warn('[compat-early] empty NodeList for (element)', sel);
        return arr;
      };
    })();
  </script>

  <!-- 読込順を保証（キャッシュバスター付き） -->
  <script defer src="js/config.js?v=20250830-9"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2?v=20250830-9"></script>
  <script defer src="js/ranking.js?v=20250830-9"></script>
  <script defer src="js/quiz.js?v=20250830-9"></script>
</head>
<body>
  <div id="app">
    <!-- 既存のクイズUI -->

    <!-- 結果画面側に必ずこのボタンが存在するようにしておく（重複OK） -->
    <button id="viewRankingBtn" data-action="open-ranking" class="btn btn-secondary">
      詳細ランキングを見る
    </button>
  </div>
  <!-- （フォールバック）クイズのルートが無い場合でも描画できるよう最低限の容器を用意 -->
  <div id="quiz" class="quiz-root"></div>
</body>
</html>
